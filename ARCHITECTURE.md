# Application Flow Diagram

## ğŸ“± App Navigation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       App Launch                            â”‚
â”‚                       (main.dart)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Permission Handler          â”‚
         â”‚   - Request Camera            â”‚
         â”‚   - Request Location          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
          â–¼                     â–¼
    Permissions             Permissions
     Denied                 Granted
          â”‚                     â”‚
          â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Retry   â”‚          â”‚   Home Screen       â”‚
    â”‚  Dialog  â”‚          â”‚   - Select Dest     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   - View Info       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                          User taps "Start Navigation"
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   AR View Screen     â”‚
                          â”‚   - Camera Preview   â”‚
                          â”‚   - Sensor Data      â”‚
                          â”‚   - AR Overlay       â”‚
                          â”‚   - Navigation Info  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Main App                             â”‚
â”‚                      (MaterialApp)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Permissionâ”‚   â”‚   Home   â”‚   â”‚ AR View  â”‚
  â”‚  Handler â”‚   â”‚  Screen  â”‚   â”‚  Screen  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                      â”‚               â”‚
                      â–¼               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Waypoint     â”‚ â”‚ AR Overlay  â”‚
              â”‚  List         â”‚ â”‚  Widget     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Waypoint     â”‚
              â”‚  Data Model   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Input â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Components  â”‚â—„â”€â”€â”€â”€â”€â”‚  State Mgmt  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Business Logic  â”‚
â”‚  - Calculate     â”‚
â”‚  - Transform     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Models    â”‚
â”‚  - Waypoint      â”‚
â”‚  - ARMarker      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rendering      â”‚
â”‚  - AR Overlay    â”‚
â”‚  - Camera View   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Sensor Integration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Magnetometer   â”‚     â”‚  Accelerometer  â”‚
â”‚  (Compass)      â”‚     â”‚  (Tilt)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚ Stream               â”‚ Stream
         â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      AR View Screen            â”‚
    â”‚   _deviceHeading               â”‚
    â”‚   _devicePitch                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Calculate          â”‚
         â”‚  - Bearing          â”‚
         â”‚  - Relative Angle   â”‚
         â”‚  - Distance         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  AR Overlay Update  â”‚
         â”‚  - Arrow rotation   â”‚
         â”‚  - Marker position  â”‚
         â”‚  - Instructions     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ AR Rendering Pipeline

```
1. Camera Frame
   â†“
2. Camera Preview Widget
   â†“
3. Stack Overlay
   â†“
4. AR Overlay Widget
   â”œâ”€â†’ Destination Marker
   â”‚   â”œâ”€â†’ Icon
   â”‚   â”œâ”€â†’ Name
   â”‚   â””â”€â†’ Distance
   â”‚
   â”œâ”€â†’ Navigation Arrow
   â”‚   â”œâ”€â†’ Direction Calculation
   â”‚   â”œâ”€â†’ Rotation Transform
   â”‚   â””â”€â†’ CustomPaint
   â”‚
   â””â”€â†’ Info Panel
       â”œâ”€â†’ Destination Name
       â”œâ”€â†’ Distance Display
       â”œâ”€â†’ Bearing Display
       â””â”€â†’ Text Instructions
```

## ğŸ”¢ Calculation Flow

```
User Position (0,0,0)
       +
Destination Position (x,y,z)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Distance Calculate  â”‚
â”‚  sqrt(dxÂ²+dyÂ²+dzÂ²)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bearing Calculate   â”‚
â”‚  atan2(dy, dx)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Relative Bearing    â”‚
â”‚  bearing - heading   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigation Instr.   â”‚
â”‚  Based on angle      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Coordinate System

```
         Y+ (North, longitude)
              â†‘
              â”‚
              â”‚
X- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ X+ (East, latitude)
   (West)     â”‚     
              â”‚
              â”‚
              â†“
         Y- (South)

Z+ = Up (altitude)
Z- = Down

Origin (0,0,0) = Starting position
```

## ğŸ® User Interaction Flow

```
1. Launch App
   â†“
2. Grant Permissions
   â†“
3. View Destination List
   â†“
4. Tap Destination
   â†“ (Selection highlighted)
5. Tap "Start Navigation"
   â†“
6. Camera Opens
   â†“
7. AR View Active
   â”‚
   â”œâ”€â†’ See Arrow (direction)
   â”œâ”€â†’ See Marker (if in view)
   â”œâ”€â†’ Read Distance
   â””â”€â†’ Read Instructions
   â†“
8. Walk & Navigate
   â”‚
   â”œâ”€â†’ Distance updates
   â”œâ”€â†’ Angle updates
   â””â”€â†’ Instructions change
   â†“
9. Reach Destination
   â†“
10. Back to Home
```

## ğŸ§© File Dependencies

```
main.dart
â”œâ”€â†’ home_screen.dart
â”‚   â”œâ”€â†’ waypoint.dart
â”‚   â”œâ”€â†’ waypoint_data.dart
â”‚   â””â”€â†’ ar_view_screen.dart
â”‚       â”œâ”€â†’ waypoint.dart
â”‚       â””â”€â†’ ar_overlay.dart
â”‚           â””â”€â†’ waypoint.dart

test/waypoint_test.dart
â”œâ”€â†’ waypoint.dart
â””â”€â†’ waypoint_data.dart
```

## ğŸ“¦ Package Dependencies Graph

```
uniwhere_ar_wayfinding
â”œâ”€â”€ flutter (SDK)
â”œâ”€â”€ camera
â”‚   â””â”€â”€ Native platform APIs
â”œâ”€â”€ permission_handler
â”‚   â””â”€â”€ Native permission APIs
â”œâ”€â”€ sensors_plus
â”‚   â””â”€â”€ Native sensor APIs
â”œâ”€â”€ vector_math
â”œâ”€â”€ flutter_compass
â”‚   â””â”€â”€ Native magnetometer
â”œâ”€â”€ geolocator
â”‚   â””â”€â”€ Native location APIs
â””â”€â”€ ar_flutter_plugin
    â””â”€â”€ ARCore/ARKit
```

## ğŸ¨ UI Component Hierarchy

```
MaterialApp
â””â”€â”€ Scaffold (Permission Handler)
    â”œâ”€â”€ If denied: Retry Dialog
    â””â”€â”€ If granted: HomeScreen
        â””â”€â”€ Scaffold
            â”œâ”€â”€ AppBar
            â””â”€â”€ Body
                â”œâ”€â”€ Info Card
                â””â”€â”€ Waypoint List
                    â”œâ”€â”€ ListTile 1
                    â”œâ”€â”€ ListTile 2
                    â”œâ”€â”€ ...
                    â””â”€â”€ Navigation Button
                        â””â”€â”€ â†’ ARViewScreen
                            â””â”€â”€ Scaffold
                                â”œâ”€â”€ AppBar
                                â””â”€â”€ Stack
                                    â”œâ”€â”€ CameraPreview
                                    â”œâ”€â”€ AROverlay
                                    â”‚   â”œâ”€â”€ Arrow
                                    â”‚   â””â”€â”€ Marker
                                    â””â”€â”€ Info Panel
```

---

This diagram shows the complete flow and structure of the AR Wayfinding application.
